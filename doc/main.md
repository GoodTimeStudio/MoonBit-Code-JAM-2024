# 模块粗略需求描述
需要将游戏的程序分为开发包和发布包，发布包需要将所有配置文件全都转换为二进制，节省内存和读取时间。  
关于整体设计，我想使用ecs架构,特别是图形和游戏内的数据处理上。
## 配置文件及开发流程
如上文所说，为了发布包尽可能小和尽可能不要把json读到内存里，我希望将开发流程使用的一部分代码和发布用的分开，但是使用的接口相同。
图片、动画、配置文件在开发中希望以json或其他方式存储，因为wasm4引擎不能使用彩色图片，只能使用4色图片。  
以及音乐使用midi文件和配置文件组成，因为只能使用4个合成器，以及要给合成器添加adsr等设置。  
在发布时，将所有图片、动画、配置文件转换为二进制。  
在使用使用一个类似 `loadResource(path)`， `loadAudio(path)` 之类的函数读出来。  
需要设计一下数据的结构。
### 图片与动画
图片和动画需要一个特殊的配置文件管理阅读器，需要发布和开发两个版本的代码。  
如何实现我还没想好，但是为了游戏表现效果，需要动画在游戏进程中可以改变颜色，所以在配置文件中可能需要标注颜色在什么时间进行改变。
### 音乐与音频系统
音频需要一个音频总线、可以调整顺序删除元素的音效栈、一个特殊的配置文件管理阅读器，这个也需要发布和开发两个版本的代码。  
音乐我希望使用midi和json标记音色来完成，但导出发布包后全导出为二进制。  
json需要能标记在什么时间或什么轨道使用什么音色。  
音频系统中还需要音效，音效可以标记为json，在开发中使用`audioStackPush(str)`来将这个音效塞进音效播放栈。因为音频通道过少，需要一个类似栈的东西可以在播放的时候调整播放权重和顺序。

## 界面及图形
界面需要类ECS的图形Node架构以及图形缓存管理器  
wasm4中的图形缓存需要手操，所以会比较麻烦。  
我想在游戏里实现一个类似通用引擎的scene/node+canvas的机制。  
每个node都会被渲染到上层的canvas里，其他设计可以参考cocos的node，但是不需要完全模仿，因为只是个小游戏而已。
这是一个类似ECS架构的界面管理。

## 游戏系统及ECS
游戏逻辑的大模块需要地图关卡编辑函数和ECS架构两块系统，小模块还需要一个简易AI，但是大概用行为树+ECS+事件就可以搓出来  
地图关卡编辑工具可能需要一个简易tilemap  